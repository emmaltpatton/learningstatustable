
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Learning Status Table</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ✅ Correct Jotform Custom Widget API include -->
  <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>

  <style>
    :root{
      /* Core colours */
      --header-color: #0c2340;
      --row-alt-color: rgba(12,35,64,.2);
      --border: #c8c8c8;
      --text: #222;

      /* Typography (can be driven by settings) */
      --form-font-family: Inter, sans-serif;
      --form-font-size: 14px;

      /* text colours driven by settings */
      --section-title-font-color: #ffffff; /* title bar text */
      --th-font-color: #ffffff;            /* <th> text */
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 12px;
      background: transparent;
      color: var(--text);
      font-family: var(--form-font-family) !important;
      font-size: var(--form-font-size);
      line-height: 1.4;
    }

    /* Title bar above the table */
    .section-title{
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 15px;
      color: var(--section-title-font-color);
      background: var(--header-color);
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-bottom: 0;
      border-radius: 2px 2px 0 0;
    }

    .table-wrap { overflow: auto; }
    table { width: 100%; border-collapse: collapse; border: 1px solid var(--border); background: #fff; }

    /* Single, variable-driven header rule */
    thead th {
      text-align: left;
      padding: 8px 10px;
      color: var(--th-font-color);
      background: var(--header-color);
      border-bottom: 1px solid var(--border);
      font-family: var(--form-font-family) !important;
      font-weight: 700;
    }

    tbody td {
      vertical-align: top; padding: 6px 10px;
      border-bottom: 1px solid var(--border); border-right: 1px solid var(--border); background: #fff;
    }
    tbody tr:nth-child(even) td { background: var(--row-alt-color); }
    tbody tr:last-child td { border-bottom: 0; }
    tbody td:last-child, thead th:last-child { border-right: 0; }

    .task-html a { color: #84bd00; text-decoration: underline; }

    .status-list { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-top: 4px; }
    .status-list label { white-space: nowrap; cursor: pointer; }

    input[type="date"]{
      width: 100%; min-width: 12ch; padding: 4px 6px;
      border: 1px solid #bfbfbf; border-radius: 3px; background: #fff;
    }

    /* Ensure table & inputs use same font */
    table, th, td, label, input, button, select, textarea {
      font-family: var(--form-font-family) !important;
      font-size: var(--form-font-size);
      color: var(--text);
    }
  </style>
</head>
<body>

  <!-- Header title container -->
  <div id="sectionTitle" class="section-title" role="heading" aria-level="2"></div>

  <div class="table-wrap">
    <table id="statusTable" aria-describedby="sectionTitle">
      <thead>
        <tr>
          <th id="col_task">Task</th>
          <th id="col_status">Status</th>
          <th id="col_date">Date</th>
        </tr>
      </thead>
      <tbody id="tableBody"><tr><td>Loading…</td></tr></tbody>
    </table>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);

    function renderHeaderTitle() {
      const box = document.getElementById('sectionTitle');
      if (!box) return;
      const title = (settings.headerTitle || '').trim();
      if (title) { box.textContent = title; box.style.display = ''; }
      else { box.style.display = 'none'; }
    }

    function hexToRgb(hex) {
      const m = (hex || '').trim().replace(/^#/, '').match(/^([0-9a-f]{3}|[0-9a-f]{6})$/i);
      if (!m) return {r:12,g:35,b:64};
      let h = m[1];
      if (h.length === 3) h = h.split('').map(x => x + x).join('');
      const int = parseInt(h, 16);
      return { r: (int >> 16) & 255, g: (int >> 8) & 255, b: int & 255 };
    }
    function tintFromHex(hex, alpha = .1) {
      const {r,g,b} = hexToRgb(hex);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }
    function stripHtml(html) {
      const d = document.createElement('div'); d.innerHTML = html || '';
      return (d.textContent || d.innerText || '').trim();
    }
    function parseLines(text) {
      if (!text) return [];
      return text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
    }
    function getRadioByValue(container, value) {
      const radios = container.querySelectorAll('input[type="radio"]');
      for (const r of radios) if (r.value === String(value)) return r;
      return null;
    }

    // ---------- PDF-friendly plain-text helpers ----------
    function padRight(str, len) {
      str = String(str ?? '');
      if (str.length >= len) return str.slice(0, len);
      return str + ' '.repeat(len - str.length);
    }
    function buildPlainTextTable(rows) {
      // tune widths as you like
      const COLW = { task: 58, status: 14, date: 12 };

      const lines = [];
      const hdr =
        padRight('Task',   COLW.task) + ' | ' +
        padRight('Status', COLW.status) + ' | ' +
        padRight('Date',   COLW.date);
      const bar = '-'.repeat(hdr.length);

      lines.push(hdr, bar);

      rows.forEach(r => {
        const taskText = (r.taskText && r.taskText.trim()) || ' ';
        const oneline = taskText.replace(/\s*\n\s*/g, ' '); // collapse newlines
        lines.push(
          padRight(oneline,           COLW.task)   + ' | ' +
          padRight(String(r.status),  COLW.status) + ' | ' +
          padRight(String(r.date),    COLW.date)
        );
      });

      return lines.join('\n');
    }

    // ---------- Defaults (overridden by Widget Settings in Jotform) ----------
    let settings = {
      rowsContent:
        'Access Employee Portal within PageUp\n' +
        'Complete all Corporate Inductions in PageUp:<ul><li><a href="https://intranet/policy">Workplace Behaviour</a></li></ul>\n' +
        'Book into relevant learning activities in PageUp',
      statusOptions: 'Complete\nNot Applicable',
      headerColor: '#0c2340',
      headerTitle: 'INDUCTION',
      autoDateOnOptions: '',                 // blank => auto-stamp on ANY status change
      formFontFamily: 'Inter, sans-serif',
      formFontSize: '14px',
      sectionTitleFontColor: '#ffffff',
      thFontColor: '#ffffff'
    };
    let initialValue = null; // restored on edit

    // ---------- Look & feel from settings ----------
    function applyTheme() {
      const root = document.documentElement;
      root.style.setProperty('--header-color', settings.headerColor);
